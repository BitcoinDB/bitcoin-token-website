
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo.png" class="logo" alt="Logo" />
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
          </li>
          <li>
            <a href="#install-and-run" class="toc-h1 toc-link" data-title="Install and run">Install and run</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#install" class="toc-h2 toc-link" data-title="Install">Install</a>
                  </li>
                  <li>
                    <a href="#run-in-node" class="toc-h2 toc-link" data-title="Run in Node">Run in Node</a>
                  </li>
                  <li>
                    <a href="#run-in-the-browser" class="toc-h2 toc-link" data-title="Run in the browser">Run in the browser</a>
                  </li>
                  <li>
                    <a href="#troubleshooting" class="toc-h2 toc-link" data-title="Troubleshooting">Troubleshooting</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#bitcoinwallet" class="toc-h1 toc-link" data-title="BitcoinWallet">BitcoinWallet</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#constructor" class="toc-h2 toc-link" data-title="constructor">constructor</a>
                  </li>
                  <li>
                    <a href="#getrandommnemonic" class="toc-h2 toc-link" data-title="getRandomMnemonic">getRandomMnemonic</a>
                  </li>
                  <li>
                    <a href="#frommnemonic" class="toc-h2 toc-link" data-title="fromMnemonic">fromMnemonic</a>
                  </li>
                  <li>
                    <a href="#getmnemonic" class="toc-h2 toc-link" data-title="getMnemonic">getMnemonic</a>
                  </li>
                  <li>
                    <a href="#getprivatekey" class="toc-h2 toc-link" data-title="getPrivateKey">getPrivateKey</a>
                  </li>
                  <li>
                    <a href="#getpublickey" class="toc-h2 toc-link" data-title="getPublicKey">getPublicKey</a>
                  </li>
                  <li>
                    <a href="#getaddress" class="toc-h2 toc-link" data-title="getAddress">getAddress</a>
                  </li>
                  <li>
                    <a href="#getbalance" class="toc-h2 toc-link" data-title="getBalance">getBalance</a>
                  </li>
                  <li>
                    <a href="#send" class="toc-h2 toc-link" data-title="send">send</a>
                  </li>
                  <li>
                    <a href="#transaction" class="toc-h2 toc-link" data-title="transaction">transaction</a>
                  </li>
                  <li>
                    <a href="#derive" class="toc-h2 toc-link" data-title="derive">derive</a>
                  </li>
                  <li>
                    <a href="#getpath" class="toc-h2 toc-link" data-title="getPath">getPath</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#bitcoindb" class="toc-h1 toc-link" data-title="BitcoinDb">BitcoinDb</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#constructor" class="toc-h2 toc-link" data-title="constructor">constructor</a>
                  </li>
                  <li>
                    <a href="#frommnemonic" class="toc-h2 toc-link" data-title="fromMnemonic">fromMnemonic</a>
                  </li>
                  <li>
                    <a href="#getwallet" class="toc-h2 toc-link" data-title="getWallet">getWallet</a>
                  </li>
                  <li>
                    <a href="#return" class="toc-h2 toc-link" data-title="return">return</a>
                  </li>
                  <li>
                    <a href="#put" class="toc-h2 toc-link" data-title="put">put</a>
                  </li>
                  <li>
                    <a href="#get" class="toc-h2 toc-link" data-title="get">get</a>
                  </li>
                  <li>
                    <a href="#update" class="toc-h2 toc-link" data-title="update">update</a>
                  </li>
                  <li>
                    <a href="#transaction" class="toc-h2 toc-link" data-title="transaction">transaction</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#bitcointoken" class="toc-h1 toc-link" data-title="BitcoinToken">BitcoinToken</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#constructor" class="toc-h2 toc-link" data-title="constructor">constructor</a>
                  </li>
                  <li>
                    <a href="#frommnemonic" class="toc-h2 toc-link" data-title="fromMnemonic">fromMnemonic</a>
                  </li>
                  <li>
                    <a href="#getwallet" class="toc-h2 toc-link" data-title="getWallet">getWallet</a>
                  </li>
                  <li>
                    <a href="#getdb" class="toc-h2 toc-link" data-title="getDb">getDb</a>
                  </li>
                  <li>
                    <a href="#create" class="toc-h2 toc-link" data-title="create">create</a>
                  </li>
                  <li>
                    <a href="#join" class="toc-h2 toc-link" data-title="join">join</a>
                  </li>
                  <li>
                    <a href="#send" class="toc-h2 toc-link" data-title="send">send</a>
                  </li>
                  <li>
                    <a href="#getbalance" class="toc-h2 toc-link" data-title="getBalance">getBalance</a>
                  </li>
              </ul>
          </li>
      </ul>
        <ul class="toc-footer">
            <li><a href='https://t.me/joinchat/FMrjOUWRuUkNuIt7zJL8tg'>Ask a question on Telegram</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">Bitcoin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'bitcointoken'</span><span class="p">)</span>

<span class="c1">// Bitcoin === { Wallet, Db, Token, Source }</span>
</code></pre>
<p>The BitcoinToken library consists of four classes</p>

<ul>
<li><strong>BitcoinWallet</strong> send, store, and receive Bitcoin Cash</li>
<li><strong>BitcoinDb</strong> store data on the Bitcoin Cash blockchain</li>
<li><strong>BitcoinToken</strong> issue tokens on Bitcoin Cash</li>
<li><strong>BitcoinSource</strong> a JS implementation of Bitcoin Cash</li>
</ul>

<p>The classes can be used independently from one another, but are designed to work well together.</p>
<h1 id='install-and-run'>Install and run</h1>
<p>You need <a href="https://docs.npmjs.com/downloading-and-installing-node-js-and-npm">node.js and npm</a> installed.</p>
<h2 id='install'>Install</h2><h3 id='create-a-bitcointoken-project'>Create a BitcoinToken project</h3>
<blockquote>
<p>Create a BitcoinToken project</p>
</blockquote>
<pre class="highlight shell_session"><code>npm i -y
npm i bitcointoken
</code></pre>
<p>Create a project by running <code>npm i -y</code> and install BitcoinToken using <code>npm i bitcointoken</code>.</p>

<p>If you only want to use BitcoinWallet you are done. If you want to use BitcoinDb or BitcoinToken you need to install and run a non-standard server.</p>
<h3 id='install-and-run-the-non-standard-server'>Install and run the non-standard server</h3>
<blockquote>
<p>Install and run the non-standard server</p>
</blockquote>
<pre class="highlight shell_session"><code>git clone https://github.com/BitcoinDB/bitcoin-non-standard-server.git
cd bitcoin-non-standard-server/
docker-compose up
</code></pre>
<p>We recommend to use <a href="https://www.docker.com/">Docker</a> and <a href="https://docs.docker.com/compose/">Docker Compose</a> to build and run the server using the command on the right. If you do not use docker you can find instructions in the <a href="https://github.com/the-bitcoin-token/bitcoin-non-standard-server">Github repo</a>.</p>
<h2 id='run-in-node'>Run in Node</h2>
<blockquote>
<p>File index.js</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">Bitcoin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'bitcointoken'</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">wallet</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Bitcoin</span><span class="p">.</span><span class="nx">Wallet</span><span class="p">()</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`address: </span><span class="p">${</span><span class="nx">wallet</span><span class="p">.</span><span class="nx">getAddress</span><span class="p">()}</span><span class="s2">`</span><span class="p">)</span>
</code></pre>
<p>After installing BitcoinToken, create a file <code>index.js</code> with the content shown on the right. Run the code using</p>

<p><code>node --experimental-repl-await index.js</code></p>

<p>The output should be similar to</p>

<p><code>address: mwZd1bgRYhxY4JLyx1sdEGBYFZnXVDvgmp</code></p>

<!--
## Run in the browser

> File index.js

````javascript
const Bitcoin = require('bitcointoken')

const wallet = new Bitcoin.Wallet()
document.body.innerHTML = `address: ${wallet.getAddress()}`
````

> File index.html

````html
<html>
  <body>
    <script src="./index.js"></script>
  </body>
</html>
````

Install <a href="https://parceljs.org">Parcel</a> using `npm install -g parcel-bundler`.

Create a files `index.js` and `index.html` in an empty folder.

Start the server using `parcel index.html`. The website will be rendered at <a href="http://localhost:1234/">http://localhost:1234/</a>.
-->
<h2 id='run-in-the-browser'>Run in the browser</h2>
<blockquote>
<p>File index.js</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">Bitcoin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'bitcointoken'</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">wallet</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Bitcoin</span><span class="p">.</span><span class="nx">Wallet</span><span class="p">()</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">`address: </span><span class="p">${</span><span class="nx">wallet</span><span class="p">.</span><span class="nx">getAddress</span><span class="p">()}</span><span class="s2">`</span>
</code></pre>
<blockquote>
<p>File index.html</p>
</blockquote>
<pre class="highlight html tab-html"><code><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"./bundle.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
<p>After installing BitcoinToken, create files <code>index.js</code> and <code>index.html</code> as shown.</p>

<p>Install and run browserify</p>

<p><code>
npm install -g browserify<br />
browserify index.js &gt; bundle.js
</code></p>

<p>Open <code>index.html</code> in a web browser</p>
<h2 id='troubleshooting'>Troubleshooting</h2>
<p>If you have a problem that is not discussed here, please let us know in the <a href="https://t.me/joinchat/FMrjOUWRuUkNuIt7zJL8tg">Telegram group</a>.</p>
<h3 id='quot-communication-error-service-unavailable-quot'>&quot;Communication error: Service unavailable&quot;</h3>
<p>The problem is most likely that you are not running the non-standard server.</p>
<h3 id='quot-error-insufficient-balance-in-address-quot'>&quot;Error: Insufficient balance in address ...&quot;</h3>
<blockquote>
<p>File generate-mnemonic.js</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">Bitcoin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'bitcointoken'</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Bitcoin</span><span class="p">.</span><span class="nx">Wallet</span><span class="p">.</span><span class="nx">getRandomMnemonic</span><span class="p">())</span>
</code></pre>
<p>You have to fund your wallet. First check that the same wallet is generated every time you run your code: Run your code multiple times and check if the  same address is logged every time.</p>

<p>If so you can fund that address using a <a href="https://coinfaucet.eu/en/bch-testnet/">testnet faucet</a>.</p>

<p>Otherwise you need to initialize your object from a mnemonic. To generate a mnemonic, create the file <code>generate-mnemonic.js</code> and run it using <code> node --experimental-repl-await generate-mnemonic.js</code>. Now you can generate your object using the logged mnemonic using <code>.fromMnemonic()</code> and fund it using the <a href="https://coinfaucet.eu/en/bch-testnet/">testnet faucet</a></p>
<h1 id='bitcoinwallet'>BitcoinWallet</h1>
<p><code>BitcoinWallet</code> allows you to receive, store, and send Bitcoin Cash.</p>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">Bitcoin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'bitcointoken'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">BitcoinWallet</span> <span class="o">=</span> <span class="nx">Bitcoin</span><span class="p">.</span><span class="nx">Wallet</span>
</code></pre>
<p>A BitcoinWallet stores a secrete passphrase called menmonic. The mnemonic represents an identity, for example every user in an application would have their own mnemonic. The mnemonic can be used to send Bitcoin to another user, or to generate public addresses that can receive Bitcoin.</p>
<h2 id='constructor'>constructor</h2>
<blockquote>
<p>Generate a random BitcoinWallet</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">BitcoinWallet</span> <span class="o">=</span> <span class="nx">Bitcoin</span><span class="p">.</span><span class="nx">Wallet</span>
<span class="kr">const</span> <span class="nx">randomWallet</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BitcoinWallet</span><span class="p">()</span>
</code></pre>
<p>Generates a new <code>BitcoinWallet</code> with a random mnemonic call the constructor.</p>

<!-- A <code>BitcoinWallet</code> object stores a <a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki">BIP32</a> extended private key. This key can be used to generate a private public key pair and a Bitcoin Cash address. Users can send Bitcoin Cash to the address to fund the wallet. The wallet object can compute the balance of the address as well as send bitcoin from it.
  
  
In addition, a <code>BitcoinWallet</code> can generate 2<sup>32</sup> (>4 billion) child <code>BitcoinWallet</code> objects. The child derivation process is recursive and can generate an infinite number of identities. As the process is deterministic, all identities can be recomputed from a single <code>HdPrivateKey</code>.

The functions of a <code>BitcoinWallet</code> object are listed below. -->
<h2 id='getrandommnemonic'>getRandomMnemonic</h2>
<blockquote>
<p>Generate a mnemonic</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">mnemonic</span> <span class="o">=</span> <span class="nx">BitcoinWallet</span><span class="p">.</span><span class="nx">getRandomMnemonic</span><span class="p">()</span>

<span class="c1">// mnemonic === 'rail install size scorpion orchard kingdom vacuum collect pencil element fall enhance media island medal'</span>
</code></pre>
<p>Generates a new mnemonic from a secure random source.</p>
<h3 id='type'>Type</h3>
<p><code>static getHdPrivateKey(): string</code></p>
<h2 id='frommnemonic'>fromMnemonic</h2>
<blockquote>
<p>Generate a BitcoinWallet from a mnemonic</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">mnemonic</span> <span class="o">=</span> <span class="nx">BitcoinWallet</span><span class="p">.</span><span class="nx">getRandomMnemonic</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">wallet</span> <span class="o">=</span> <span class="nx">BitcoinWallet</span><span class="p">.</span><span class="nx">fromMnemonic</span><span class="p">(</span><span class="nx">mnemonic</span><span class="p">)</span>
</code></pre>
<p>Generates <code>BitcoinWallet</code> from a the mnemonic.</p>
<h3 id='type-2'>Type</h3>
<p><code>static getRandomMnemonic(mnemonic: string): BitcoinWallet</code></p>
<h2 id='getmnemonic'>getMnemonic</h2>
<blockquote>
<p>Return the mnemonic</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">wallet</span> <span class="o">=</span> <span class="nx">BitcoinWallet</span><span class="p">.</span><span class="nx">fromMnemonic</span><span class="p">(</span><span class="s1">'rail install size scorpion orchard kingdom vacuum collect pencil element fall enhance media island medal'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">mnemonic</span> <span class="o">=</span> <span class="nx">wallet</span><span class="p">.</span><span class="nx">getMnemonic</span><span class="p">()</span>

<span class="c1">// menominc === 'rail install size scorpion orchard kingdom vacuum collect pencil element fall enhance media island medal'</span>
</code></pre>
<p>Returns the mnemonic of the wallet</p>
<h3 id='type-3'>Type</h3>
<p><code>getMnemonic(): string</code></p>
<h2 id='getprivatekey'>getPrivateKey</h2>
<blockquote>
<p>Return the private key</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">privateKey</span> <span class="o">=</span> <span class="nx">wallet</span><span class="p">.</span><span class="nx">getPrivateKey</span><span class="p">()</span>
</code></pre>
<p>Every BitcoinWallet is associated with a Bitcoin account consisting of a private-public keypair and an address. These can be accessed using <code>getPrivateKey</code>, <code>getPublicKey</code> and <code>getAddress</code>.</p>

<p><code>getPrivateKey</code> return the private key stored in the wallet.</p>
<h3 id='type-4'>Type</h3>
<p><code>getPrivateKey(): string</code></p>
<h2 id='getpublickey'>getPublicKey</h2>
<blockquote>
<p>Return the public key</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">publicKey</span> <span class="o">=</span> <span class="nx">wallet</span><span class="p">.</span><span class="nx">getPublicKey</span><span class="p">()</span>
</code></pre>
<p>Returns the public key.</p>
<h3 id='type-5'>Type</h3>
<p><code>getPublicKey(): string</code></p>
<h2 id='getaddress'>getAddress</h2>
<blockquote>
<p>Return the address</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">address</span> <span class="o">=</span> <span class="nx">wallet</span><span class="p">.</span><span class="nx">getAddress</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">CashAddress</span> <span class="o">=</span> <span class="nx">wallet</span><span class="p">.</span><span class="nx">getAddress</span><span class="p">(</span><span class="s1">'cashaddr'</span><span class="p">)</span>
</code></pre>
<p>Returns the address in <code>legacy</code> format. To return the address in a different format pass in <code>legacy</code>, <code>bitpay</code>, or <code>cashaddr</code> as a parameter.</p>
<h3 id='type-6'>Type</h3>
<p><code>
type Format = &#39;legacy&#39; | &#39;bitpay&#39; | &#39;cashaddr&#39;<br />
getAddress(format?: Format = &#39;legacy&#39;): string
</code></p>
<h2 id='getbalance'>getBalance</h2>
<blockquote>
<p>Return the current balance</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">satoshi</span> <span class="o">=</span> <span class="nx">wallet</span><span class="p">.</span><span class="nx">getBalance</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">bitcoin</span> <span class="o">=</span> <span class="nx">satoshi</span> <span class="o">/</span> <span class="mi">1</span><span class="nx">e8</span>
</code></pre>
<p>Returns the current balance in satoshi. Divide by <code>1e8</code> to compute the balance in Bitcoin.</p>
<h3 id='type-7'>Type</h3>
<p><code>getBalance(): number</code></p>

<aside class="notice">Note that `getBalance` returns the balance of the current account and not the balance of derived accounts.</aside>
<h2 id='send'>send</h2>
<blockquote>
<p>Send Bitcoin</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">address</span> <span class="o">=</span> <span class="nx">randomWallet</span><span class="p">.</span><span class="nx">getAddress</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">outputId</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">wallet</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="mi">15000</span><span class="p">,</span> <span class="nx">address</span><span class="p">)</span>

<span class="c1">// outputId === {</span>
<span class="c1">//   txId: '3404832a17d996dffaa9ac1aea48a2fafc9d855e5fdca5100481d8a562523dfb',</span>
<span class="c1">//   outputNumber: 0</span>
<span class="c1">// }</span>
</code></pre>
<p>Sends bitcoin. The first parameter is the amount to send in satoshi, the second is the recipients address, and the third (optional) paramater is the change address. If no change address is provided, the address of the wallet is used.</p>
<h3 id='type-8'>Type</h3>
<p><code>type OutputId = {|<br />
&nbsp;&nbsp;txId: string,<br />
&nbsp;&nbsp;outputNumber: number<br />
}<br />
<br />
async send(<br />
&nbsp;&nbsp;amount: number,<br />
&nbsp;&nbsp;address: string,<br />
&nbsp;&nbsp;changeAddress: ?string<br />
): Promise&lt;OutputId&gt;<br />
</code></p>
<h2 id='transaction'>transaction</h2>
<blockquote>
<p>Send Bitcoin to multiple recipients</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">address</span> <span class="o">=</span> <span class="nx">randomWallet</span><span class="p">.</span><span class="nx">getAddress</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">data1</span> <span class="o">=</span> <span class="p">{</span> <span class="na">amount</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span> <span class="na">address</span><span class="p">:</span> <span class="s1">'mvQPGnzRT6gMWASZBMg7NcT3vmvsSKSQtf'</span> <span class="p">}</span>
<span class="kr">const</span> <span class="nx">data2</span> <span class="o">=</span> <span class="p">{</span> <span class="na">amount</span><span class="p">:</span> <span class="mi">5000</span><span class="p">,</span> <span class="na">address</span><span class="p">:</span> <span class="s1">'n1xqzrckuoohZPj3XoMn1mRgJZ3nkCLSq3'</span> <span class="p">}</span>
<span class="kr">const</span> <span class="nx">outputIds</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">wallet</span><span class="p">.</span><span class="nx">transaction</span><span class="p">([</span><span class="nx">data1</span><span class="p">,</span> <span class="nx">data2</span><span class="p">])</span>

<span class="c1">// outputIds === [{</span>
<span class="c1">//   txId: '3404832a17d996dffaa9ac1aea48a2fafc9d855e5fdca5100481d8a562523dfb',</span>
<span class="c1">//   outputNumber: 0</span>
<span class="c1">// }, {</span>
<span class="c1">//   txId: '3404832a17d996dffaa9ac1aea48a2fafc9d855e5fdca5100481d8a562523dfb',</span>
<span class="c1">//   outputNumber: 1</span>
<span class="c1">// }]</span>
</code></pre>
<p>Use <code>transaction</code> to pay multiple parties at once. </p>
<h3 id='type-9'>Type</h3>
<p><code>type OutputId = {|<br />
&nbsp;&nbsp;txId: string,<br />
&nbsp;&nbsp;outputNumber: number<br />
}<br />
<br />
type PkhData = {|<br />
&nbsp;&nbsp;amount: number,<br />
&nbsp;&nbsp;address: string<br />
|}<br />
<br />
async transaction(<br />
&nbsp;&nbsp;outputs: Array&lt;PkhData&gt;,<br />
&nbsp;&nbsp;changeAddress?: string<br />
): Promise&lt;Array&lt;OutputId&gt;&gt;<br />
</code></p>
<h2 id='derive'>derive</h2>
<blockquote>
<p>Derive a child wallet</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">derivedWallet</span> <span class="o">=</span> <span class="nx">wallet</span><span class="p">.</span><span class="nx">derive</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</code></pre>
<p>A BitcoinWallet can deterministically derive <em>2<sup>32</sup></em> child wallets. To derive a child wallet call <code>derive</code> with a number <em>&le; 2<sup>32</sup></em>. The second optional parameter determines if the wallet if hardened or not. Read more about hardened wallets in <a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki">BIP32</a>.</p>

<blockquote>
<p>Derive wallet with path <code>m/44&#39;/0&#39;/0&#39;</code></p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">wallet</span> <span class="o">=</span> <span class="nx">wallet</span><span class="p">.</span><span class="nx">derive</span><span class="p">(</span><span class="s1">'m'</span><span class="p">,</span> <span class="kc">false</span><span class="p">).</span><span class="nx">derive</span><span class="p">(</span><span class="mi">44</span><span class="p">,</span> <span class="kc">true</span><span class="p">).</span><span class="nx">derive</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">).</span><span class="nx">derive</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
</code></pre>
<p>There exists a standard for how to use derivation paths to generate interoperable wallets (<a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki">BIP44</a>). Two popular derivation paths are</p>

<ul>
<li><code>m/44&#39;/0&#39;/0&#39;</code> used eg by Yours.org, Bitcoin.com, or Coinbase.com</li>
<li><code>m/44&#39;/145&#39;/0&#39;</code> used eg by Bitpay. </li>
</ul>
<h3 id='type-10'>Type</h3>
<p><code>
derive(<br />
&nbsp;&nbsp;index: ?number = 0,<br />
&nbsp;&nbsp;hardened: ?boolean = false<br />
): BitcoinWallet
</code></p>
<h2 id='getpath'>getPath</h2>
<blockquote>
<p>Return the current derivation path</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">wallet</span> <span class="o">=</span> <span class="nx">wallet</span><span class="p">.</span><span class="nx">derive</span><span class="p">(</span><span class="s1">'m'</span><span class="p">,</span> <span class="kc">false</span><span class="p">).</span><span class="nx">derive</span><span class="p">(</span><span class="mi">44</span><span class="p">,</span> <span class="kc">true</span><span class="p">).</span><span class="nx">derive</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">).</span><span class="nx">derive</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">wallet</span><span class="p">.</span><span class="nx">getPath</span><span class="p">()</span>

<span class="c1">// path === `m/44'/0'/0'`</span>
</code></pre>
<p>Returns the current derivation path.</p>
<h3 id='type-11'>Type</h3>
<p><code>
getPath(): string
</code></p>
<h1 id='bitcoindb'>BitcoinDb</h1><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">Bitcoin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'bitcointoken'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">BitcoinDb</span> <span class="o">=</span> <span class="nx">Bitcoin</span><span class="p">.</span><span class="nx">Db</span>
</code></pre>
<p><code>BitcoinDb</code> objects can store data in json format on the Bitcoin Cash blockchain, as well as read and update then.</p>

<p>Bitcoin exposes two ways to store data: in <a href="https://en.bitcoin.it/wiki/OP_RETURN">op_return</a> outputs and in output scripts via <a href="https://en.bitcoin.it/wiki/Pay_to_script_hash">p2sh</a>. Both are supported by BitcoinToken and have different trade offs.</p>

<p>To store a string of data that does not need to be updated the recommended format is to use op_return via <code>db.return</code>.</p>

<p>If your application requires data types, updates, or transactions it is recommended to store data in p2sh output scripts via <code>db.put</code>. The trade off is that your data will only be stored on the blockchain once you update the data, before that only a hash of the data is stored in the blockchain.</p>

<aside class="warning">You need to run a <a href="https://github.com/the-bitcoin-token/bitcoin-non-standard-server">non-standard server</a> to use BitcoinDb.</aside>

<!-- The storage model of BitcoinDb is designed to work as similar to Bitcoin as possible. In Bitcoin, the current state is stored in the unspent transaction output (utxo) set. The state is updated when a Bitcoin transaction is broadcast. The outputs representing the old state are removed from the utxo set and replaced by the outputs of the transaction that represent the new state.

Similarly, BitcoinDb stores data is unspent transaction outputs. When data is updated, the outputs representing the old state are spent and outputs representing the new state are created. The convention is that the i-th output represents the new state of the i-th input being spent. This leads to a natural notion of data ownership where the data is owned by the users(s) that can spend and thereby update the output that contains the data.

The location on the blockchain where data is stored is captured by an <code>OutputId</code> object, which contains two keys <code>txId</code> and <code>outputNumber</code> (that is an <code>OutputId</code> object has type <code>{| txId: string, outputNumber: number |})</code> in <a href="https://flow.org/">flow type</a> notation). -->
<h2 id='constructor'>constructor</h2>
<blockquote>
<p>Create random BitcoinDb</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">BitcoinDb</span> <span class="o">=</span> <span class="nx">Bitcoin</span><span class="p">.</span><span class="nx">Db</span>
<span class="kr">const</span> <span class="nx">randomDb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BitcoinDb</span><span class="p">()</span>
</code></pre>
<p>A <code>BicoinDb</code> object stores a <code>BitcoinWallet</code> object to pay for storage space on the blockchain. To generate a <code>BitcoinDb</code> object from a new randomly generated <code>BitcoinWallet</code> object call the constructor without a parameter.</p>

<blockquote>
<p>Create BitcoinDb from a BitcoinWallet</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">BitcoinDb</span> <span class="o">=</span> <span class="nx">Bitcoin</span><span class="p">.</span><span class="nx">Db</span>
<span class="kr">const</span> <span class="nx">wallet</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Bitcoin</span><span class="p">.</span><span class="nx">Wallet</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Bitcoin</span><span class="p">.</span><span class="nx">Db</span><span class="p">(</span><span class="nx">wallet</span><span class="p">)</span>
</code></pre>
<p>You can also create a new <code>BitcoinWallet</code> object from an existing <code>BitcoinWallet</code> object by passing it into the constructor.</p>
<h2 id='frommnemonic'>fromMnemonic</h2>
<blockquote>
<p>Generate a BitcoinDb from a mnemonic</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">mnemonic</span> <span class="o">=</span> <span class="nx">BitcoinWallet</span><span class="p">.</span><span class="nx">getRandomMnemonic</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">BitcoinDb</span><span class="p">.</span><span class="nx">fromMnemonic</span><span class="p">(</span><span class="nx">mnemonic</span><span class="p">)</span>
</code></pre>
<p>Generates <code>BitcoinDb</code> object and initialize the embedded <code>BitcoinWallet</code> using the mnemonic.</p>
<h3 id='type'>Type</h3>
<p><code>static fromMnemonic(mnemonic: string): BitcoinWallet</code></p>

<aside class="notice">The mnemonic of a `BitcoinDb` object can be accessed via `db.getWallet().getMnemonic()`.</aside>
<h2 id='getwallet'>getWallet</h2>
<blockquote>
<p>Return the wallet stored in the db</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BitcoinDb</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">wallet</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">getWallet</span><span class="p">()</span>

<span class="c1">// wallet.constructor.name === 'BitcoinWallet`</span>
</code></pre>
<p>Returns the <code>BitcoinWallet</code> stored in a <code>BitcoinDb</code> object.</p>
<h3 id='type-2'>Type</h3>
<p><code>getWallet(): BitcoinWallet</code></p>
<h2 id='return'>return</h2>
<blockquote>
<p>Store a string on the blockchain</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="s1">'some string'</span>
<span class="kr">const</span> <span class="nx">outputId</span> <span class="o">=</span> <span class="nx">BitcoinDb</span><span class="p">.</span><span class="k">return</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
</code></pre>
<p>Stores a string in an op_return output of a Bitcoin transaction. The string can have up to 110 characters.</p>
<h3 id='type-3'>Type</h3>
<p><code>static getRandomMnemonic(mnemonic: string): BitcoinWallet</code></p>
<h2 id='put'>put</h2>
<blockquote>
<p>Store a piece of data</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">outputId</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span> <span class="na">key</span><span class="p">:</span> <span class="s1">'string value'</span><span class="p">})</span>

<span class="c1">// outputId === {</span>
<span class="c1">//   txId: '3404832a17d996dffaa9ac1aea48a2fafc9d855e5fdca5100481d8a562523dfb',</span>
<span class="c1">//   outputNumber: 0</span>
<span class="c1">// }</span>
</code></pre>
<p>Stores a json object on the Bitcoin Cash blockchain. The simplest way to use it is to pass in a json object:</p>

<p>The data is encoded and stored in a data output script. The user(s) that can spend the output is the only person that can update that data. We call those user(s) the owner(s) of the data. By default the user to issue the command is the owner, to designate a different owner, pass in that users public key as the second argument.</p>

<blockquote>
<p>Store a piece of data and it&#39;s owner</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">publicKey</span> <span class="o">=</span> <span class="nx">randomWallet</span><span class="p">.</span><span class="nx">getPublicKey</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">outputId</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span> <span class="na">key</span><span class="p">:</span> <span class="s1">'string value'</span><span class="p">},</span> <span class="p">[</span><span class="nx">publicKey</span><span class="p">])</span>
</code></pre>
<p>The third argument is an amount of satoshi that will be stored in the output containing the data.</p>

<blockquote>
<p>Store a piece of data, it&#39;s owner, and an amount</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">publicKey</span> <span class="o">=</span> <span class="nx">randomWallet</span><span class="p">.</span><span class="nx">getPublicKey</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">outputId</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span> <span class="na">key</span><span class="p">:</span> <span class="s1">'string value'</span><span class="p">},</span> <span class="p">[</span><span class="nx">publicKey</span><span class="p">],</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">1</span><span class="nx">e8</span><span class="p">)</span>
</code></pre><h3 id='type-4'>Type</h3>
<p><code>
type OutputId = {|<br />
&nbsp;&nbsp;txId: string,<br />
&nbsp;&nbsp;outputNumber: number<br />
|}<br />
<br />
async put(<br />
&nbsp;&nbsp;data: Object,<br />
&nbsp;&nbsp;owners?: Array&lt;string&gt;,<br />
&nbsp;&nbsp;amount?: number = MIN_NON_DUST_AMOUNT<br />
): Promise&lt;OutputId&gt;<br />
</code></p>

<aside class="notice">Note: We currently only support objects with string keys and string values. Also the strings much be relatively short (around 300 characters). Please let us know if your application needs to store bigger documents and we will add support for that.</aside>
<h2 id='get'>get</h2>
<blockquote>
<p>Retrieve data from the blockchain</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">BitcoinDb</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span> <span class="na">value</span><span class="p">:</span> <span class="s1">'a'</span> <span class="p">})</span>
<span class="kr">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">BitcoinDb</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>

<span class="c1">// res === { </span>
<span class="c1">//   data: { value: 'a' },</span>
<span class="c1">//   owners: [ '03223d34686d6f19d20519156a030f7216e5d5bd6daa9442572bbaa446d06c8dfe' ],</span>
<span class="c1">//   amount: 2750</span>
<span class="c1">// }</span>
</code></pre>
<p>Retrieves a json object from the Bitcoin Cash blockchain given an <code>OutputId</code> object that specifies a location on the blockchain.</p>

<p>The return value is of type <code>OutputData</code> which is an object with three keys: <code>data</code> containing the data stored at the provided <code>OutputId</code>, <code>data</code> containing a list of string encoded public keys that correspond to the owners, and <code>amount</code> which is the number of satoshis stored in that output.</p>
<h3 id='type-5'>Type</h3>
<p><code>
type OutputId = {|<br />
&nbsp;&nbsp;txId: string,<br />
&nbsp;&nbsp;outputNumber: number<br />
|}<br />
<br />
type OutputData = {|<br />
&nbsp;&nbsp;data: string,<br />
&nbsp;&nbsp;owners: Array&lt;string&gt;,<br />
&nbsp;&nbsp;amount: number<br />
|}<br />
<br />
async get(<br />
&nbsp;&nbsp;outputId: OutputId<br />
): Promise&lt;OutputData&gt;
</code></p>
<h2 id='update'>update</h2>
<blockquote>
<p>Update a piece of data</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BitcoinDb</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">outputId1</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span> <span class="na">value</span><span class="p">:</span> <span class="s1">'a'</span> <span class="p">})</span>
<span class="kr">const</span> <span class="nx">outputId2</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">outputId1</span><span class="p">,</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="s1">'b'</span><span class="p">})</span>

<span class="c1">// outputId2 === {</span>
<span class="c1">//   txId: '3404832a17d996dffaa9ac1aea48a2fafc9d855e5fdca5100481d8a562523dfb',</span>
<span class="c1">//   outputNumber: 0</span>
<span class="c1">// }</span>
</code></pre>
<p>Updates an object stored on the blockchain and returns the location of the new data. The first parameter is the <code>OutputId</code> of the output containing the data that is to be updated, the second parameter is the new data. There are two optional parameters &quot;owners&quot; and &quot;amount&quot; that act just like the optional parameters of <code>db.put</code>. </p>

<blockquote>
<p>Data can only be updated once</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BitcoinDb</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">outputId1</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span> <span class="na">value</span><span class="p">:</span> <span class="s1">'a'</span> <span class="p">})</span>

<span class="c1">// works </span>
<span class="kr">const</span> <span class="nx">outputId2</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">outputId1</span><span class="p">,</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="s1">'b'</span><span class="p">})</span>

<span class="c1">// throws an error bc the data at outputId1 has been updated</span>
<span class="kr">const</span> <span class="nx">outputId3</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">outputId1</span><span class="p">,</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="s1">'c'</span><span class="p">})</span>
</code></pre>
<p>Data can only be updated once, an attempt to update the same piece of data will throw an error</p>

<p>Only the owner of a piece of data can update it, <code>db.update()</code> with throw an error if a user that does not own the data is trying to update it.</p>

<blockquote>
<p>Only the owner can update data</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">db1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BitcoinDb</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">db2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BitcoinDb</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">outputId1</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">db1</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span> <span class="na">value</span><span class="p">:</span> <span class="s1">'a'</span> <span class="p">})</span>

<span class="c1">// works bc data at outputId1 is owned by db1</span>
<span class="kr">const</span> <span class="nx">outputId2</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">db1</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">outputId1</span><span class="p">,</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="s1">'b'</span><span class="p">},</span> <span class="p">[</span><span class="nx">db2</span><span class="p">.</span><span class="nx">getWallet</span><span class="p">().</span><span class="nx">getPublicKey</span><span class="p">()])</span>

<span class="c1">// throws an error bc the data at outputId2 is owned by db2</span>
<span class="kr">const</span> <span class="nx">outputId3</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">db1</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">outputId2</span><span class="p">,</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="s1">'c'</span><span class="p">})</span>
</code></pre><h3 id='type-6'>Type</h3>
<p><code>
type OutputId = {|<br />
&nbsp;&nbsp;txId: string,<br />
&nbsp;&nbsp;outputNumber: number<br />
|}<br />
<br />
async update(<br />
&nbsp;&nbsp;outputId: OutputId,<br />
&nbsp;&nbsp;data: object,<br />
&nbsp;&nbsp;owners?: Array&lt;string&gt;,<br />
&nbsp;&nbsp;amount?: number = MIN_NON_DUST_AMOUNT<br />
): Promise&lt;OutputId&gt;
</code></p>
<h2 id='transaction'>transaction</h2>
<blockquote>
<p>Update multiple pieces of data simultaneously</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BitcoinDb</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">outputId1</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span> <span class="na">value</span><span class="p">:</span> <span class="s1">'a'</span> <span class="p">})</span>
<span class="kr">const</span> <span class="nx">outputId2</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span> <span class="na">value</span><span class="p">:</span> <span class="s1">'b'</span> <span class="p">})</span>
<span class="kr">const</span> <span class="p">[</span><span class="nx">outputId3</span><span class="p">,</span> <span class="nx">outputId4</span><span class="p">]</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">transaction</span><span class="p">(</span><span class="nx">outputId1</span><span class="p">,</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="s1">'b'</span><span class="p">})</span>
</code></pre>
<p>You can group multiple updates into a single transaction by calling <code>db.transaction</code>. A BitcoinDb transaction satisfies the <a href="https://en.m.wikipedia.org/wiki/ACID_(computer_science)">ACID</a> properties of traditional database systems.</p>
<h3 id='type-7'>Type</h3>
<p><code>
type OutputId = {|<br />
&nbsp;&nbsp;txId: string,<br />
&nbsp;&nbsp;outputNumber: number<br />
|}<br />
<br />
type Update = {|<br />
&nbsp;&nbsp;outputId: OutputId,<br />
&nbsp;&nbsp;data: Object,<br />
&nbsp;&nbsp;owners: Array&lt;string&gt;,<br />
&nbsp;&nbsp;amount?: number<br />
|}<br />
<br />
async transaction(<br />
&nbsp;&nbsp;update: Array&lt;Update&gt;<br />
): Promise&lt;Array&lt;OutputId&gt;&gt; {<br />
</code></p>
<h1 id='bitcointoken'>BitcoinToken</h1>
<p><code>BitcoinToken</code> objects can issue a token and send them to another user. It can also return the current balance in tokens.</p>

<aside class="warning">You need to run a <a href="https://github.com/the-bitcoin-token/bitcoin-non-standard-server">non-standard server</a> to use BitcoinToken.</aside>
<h2 id='constructor'>constructor</h2>
<blockquote>
<p>Create random BitcoinToken</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">BitcoinToken</span> <span class="o">=</span> <span class="nx">Bitcoin</span><span class="p">.</span><span class="nx">Token</span>
<span class="kr">const</span> <span class="nx">randomToken</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BitcoinToken</span><span class="p">()</span>
</code></pre>
<p>A <code>BitcoinToken</code> object contains a <code>BitcoinDb</code> object to store data on the blockchain. Recall that each <code>BitcoinDb</code> object stores a mnemonic that serves as it&#39;s identity. To generate a <code>BitcoinToken</code> object from a new randomly generated <code>BitcoinWallet</code> object call the constructor without a parameter.</p>

<blockquote>
<p>Create BitcoinToken from a BitcoinDb</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Bitcoin</span><span class="p">.</span><span class="nx">Db</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Bitcoin</span><span class="p">.</span><span class="nx">Token</span><span class="p">(</span><span class="nx">db</span><span class="p">)</span>
</code></pre>
<p>You can also create a new <code>BitcoinToken</code> object from an existing <code>BitcoinDb</code> object by passing it into the constructor.</p>
<h2 id='frommnemonic'>fromMnemonic</h2>
<blockquote>
<p>Generate a BitcoinToken from a mnemonic</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">mnemonic</span> <span class="o">=</span> <span class="nx">BitcoinWallet</span><span class="p">.</span><span class="nx">getRandomMnemonic</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">BitcoinToken</span><span class="p">.</span><span class="nx">fromMnemonic</span><span class="p">(</span><span class="nx">mnemonic</span><span class="p">)</span>
</code></pre>
<p>Generates <code>BitcoinToken</code> object and initialize the embedded <code>BitcoinWallet</code> using the mnemonic.</p>
<h3 id='type'>Type</h3>
<p><code>static fromMnemonic(mnemonic: string): BitcoinToken</code></p>

<aside class="notice">The mnemonic and other properties of the wallet contained in a <code>BitcoinToken</code> object can be accessed via <code>db.getWallet().getMnemonic()</code>.</aside>
<h2 id='getwallet'>getWallet</h2>
<blockquote>
<p>Return the wallet</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BitcoinToken</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">wallet</span> <span class="o">=</span> <span class="nx">token</span><span class="p">.</span><span class="nx">getWallet</span><span class="p">()</span>

<span class="c1">// wallet.constructor.name === 'BitcoinWallet`</span>
</code></pre>
<p>Returns the wallet stored in the db contained in the <code>BitcoinToken</code> object.</p>
<h3 id='type-2'>Type</h3>
<p><code>getWallet(): BitcoinWallet</code></p>
<h2 id='getdb'>getDb</h2>
<blockquote>
<p>Return the db</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BitcoinToken</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">token</span><span class="p">.</span><span class="nx">getDb</span><span class="p">()</span>

<span class="c1">// db.constructor.name === 'BitcoinDb`</span>
</code></pre>
<p>Returns the <code>BitcoinDb</code> stored in the <code>BitcoinToken</code> object.</p>
<h3 id='type-3'>Type</h3>
<p><code>getDb(): BitcoinDb</code></p>
<h2 id='create'>create</h2>
<blockquote>
<p>Issue a token</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">tokenId</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">token</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
  <span class="na">balance</span><span class="p">:</span> <span class="s1">'10'</span><span class="p">,</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'my-token'</span><span class="p">,</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'www.mytoken.com'</span><span class="p">,</span>
<span class="p">})</span>
</code></pre>
<p>Issues a new fungible token, similar to ERC20 tokens on Ethereum. The parameter must be an object that can be passes into <code>BitcoinDb.put</code>, that is a json object with string keys and string values. It must have one key <code>balance</code> whose value indicates the initial number of tokens.</p>
<h3 id='type-4'>Type</h3>
<p><code>async create(data: Object): Promise&lt;OutputId&gt;</code></p>

<aside class="warning"><strong>Known issue</strong> The token implementation is currently 100% trustless but not very efficient. In particular, it does not store intermediary results and re-does many computations. This will be fixed in an upcoming release.<br /><br />

If developing with BitcoinToken and the system becomes slow, we recommend to delete both tables in the non-standard server.
</aside>
<h2 id='join'>join</h2>
<blockquote>
<p>Connect to an issued token</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">tokenAlice</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Token</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">tokenBob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Token</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">tokenId</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">tokenAlice</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span> <span class="na">balance</span><span class="p">:</span> <span class="s1">'10'</span> <span class="p">})</span>
<span class="nx">tokenBob</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">tokenId</span><span class="p">)</span>
</code></pre>
<p>Connects a <code>BitcoinToken</code> object a token that has been issued using <code>token.create</code>. The balance will be calculated with respect to the token being joined.</p>
<h3 id='type-5'>Type</h3>
<p><code>join(tokenId: OutputId): void</code></p>
<h2 id='send'>send</h2>
<blockquote>
<p>Send a token</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">tokenAlice</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BitcoinToken</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">tokenId</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">tokenAlice</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span> <span class="na">balance</span><span class="p">:</span> <span class="s1">'10'</span> <span class="p">})</span>

<span class="kr">const</span> <span class="nx">tokenBob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BitcoinToken</span><span class="p">()</span>
<span class="nx">tokenBob</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">tokenId</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">publicKeyBob</span> <span class="o">=</span> <span class="nx">tokenBob</span><span class="p">.</span><span class="nx">getWallet</span><span class="p">().</span><span class="nx">getPublicKey</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">outputIds</span> <span class="o">=</span> <span class="kr">const</span> <span class="nx">tokenAlice</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">publicKeyBob</span><span class="p">)</span>

<span class="c1">// outputIds === [{</span>
<span class="c1">//   txId: '3404832a17d996dffaa9ac1aea48a2fafc9d855e5fdca5100481d8a562523dfb',</span>
<span class="c1">//   outputNumber: 0</span>
<span class="c1">// }]</span>
</code></pre>
<p>Sends tokens to another user. The first parameter is the number of tokens to send and the second is the public key of the recipient. Sending a token might involve a change output, just like the change output used when sending Bitcoin. The function returns a promise that resolves to an array of OutputIds that containing the newly created outputs that reflect the new state.</p>
<h3 id='type-6'>Type</h3>
<p><code>
type OutputId = {|<br />
&nbsp;&nbsp;txId: string,<br />
&nbsp;&nbsp;outputNumber: number<br />
|}<br />
<br />
send(<br />
&nbsp;&nbsp;amount: number,<br />
&nbsp;&nbsp;publicKey: string<br />
): Promise&lt;Array&lt;OutputId&gt;&gt;<br />
</code></p>
<h2 id='getbalance'>getBalance</h2>
<blockquote>
<p>Return the balance in tokens</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BitcoinToken</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">tokenId</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">token</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
  <span class="na">balance</span><span class="p">:</span> <span class="mi">10</span>
<span class="p">})</span>

<span class="kr">const</span> <span class="nx">balance1</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">token</span><span class="p">.</span><span class="nx">getBalance</span><span class="p">()</span>
<span class="c1">// balance1 === 10</span>

<span class="kr">const</span> <span class="nx">randomPublicKey</span>  <span class="o">=</span> <span class="k">new</span> <span class="nx">BitcoinWallet</span><span class="p">().</span><span class="nx">getPublicKey</span><span class="p">()</span>
<span class="nx">await</span> <span class="nx">token</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">randomPublicKey</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">balance2</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">token</span><span class="p">.</span><span class="nx">getBalance</span><span class="p">()</span>
<span class="c1">// balance2 === 9</span>
</code></pre>
<p>Returns the number of tokens owned by the current <code>BitcoinToken</code> object.</p>
<h3 id='type-7'>Type</h3>
<p><code>getBalance(): Promise&lt;number&gt;</code></p>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
